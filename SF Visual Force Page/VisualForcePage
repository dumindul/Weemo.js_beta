<apex:page showHeader="false" sidebar="false">
<style>
body{
    background: #0074BC;
}

#videobox{
    margin-left: -10px;
    margin-top: -5px;
}

.small {-webkit-transform: scale(0.5); -moz-transform: scale(0.5); -o-transform: scale(0.5);-webkit-transition: all 3s linear; -moz-transition: all 3s linear; -o-transition: all 3s linear;}

.big {-webkit-transform: scale(1); -moz-transform: scale(1); -o-transform: scale(1);-webkit-transition: all 3s linear; -moz-transition: all 3s linear; -o-transition: all 3s linear;}

</style>
<link rel="stylesheet" href="https://na15.salesforce.com/resource/1387913792000/weemocss" />
<script type='text/javascript' src='https://c.la2c1.salesforceliveagent.com/content/g/js/29.0/deployment.js'></script>
<script type='text/javascript' src="/support/console/29.0/integration.js"></script>
<script src="/soap/ajax/19.0/connection.js" type="text/javascript" />

  <!-- Begin Default Content REMOVE -->
<div id="clickToCall" onclick="toogleImage();testGetDetailsByPrimaryTabId();return false;" style="margin-top: 160px;height: 81px;text-align: center;">
<img id="imgToChange" class="big" src="http://www.weemo.com/wp-content/uploads/2013/06/weemo-logo-white.png" style="cursor: pointer;"/>
<br /><div id="labelToCall" style="color:white;"></div>
</div>
<script type="text/javascript">
var script = document.createElement("SCRIPT");
script.src = 'https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js';
script.type = 'text/javascript';
document.getElementsByTagName("head")[0].appendChild(script);
var modal;
var tabToFindUser;
var checkReady = function(callback) {
    if (window.jQuery) {
        callback(jQuery);
    }
    else {
        window.setTimeout(function() { checkReady(callback); }, 100);
    }
};
    // Start polling...
checkReady(function($) {
  $.when(
      $.getScript("https://download.weemo.com/js/webappid/MyAppIdentifier/"),
      $.Deferred(
        function( deferred ){
          $( deferred.resolve );
      })
  ).done(function(){
     weemo = new Weemo("MyAppIdentifier","{!$User.Username}","internal"); 
    weemo.onConnectionHandler = function(message, code) {
        if(window.console)
            console.log("Connection Handler : " + message + ' ' + code);
        switch(message) {
            case 'connectedWebRTC':
            case 'connectedWeemoDriver':
                weemo.authenticate();
                break;
           case 'loggedasotheruser':
           case 'loggedasotherdevice':
                weemo.authenticate(1);
                break;
           case 'sipOk':
                break;
        }
    }

    weemo.onWeemoDriverNotStarted = function(downloadUrl) {
        alert(downloadUrl);
    }

    weemo.setDebugLevel(1);
    weemo.setDisplayName('{!$User.FirstName} {!$User.LastName}');
    weemo.initialize();

  });
})

var eventHandler = function (result) {
    tabToFindUser = result.id.toLowerCase();
    sforce.console.chat.getDetailsByPrimaryTabId(tabToFindUser, setVisitorName);
};

function testGetDetailsByPrimaryTabId() {
    var primaryTabId = tabToFindUser;
    sforce.console.chat.getDetailsByPrimaryTabId(primaryTabId, getDetailsSuccess);
}

function getDetailsSuccess(result) {
    //Report whether accepting the chat was succesful
    if (result.success == true) {
        console.log(result);
        visitorId = result.details.customDetails[0].value.toLowerCase();
        weemo.createCall(visitorId, "internal", "Visitor");
    } else {
        console.log('Getting the details was not Succesful');
    }
};

function setVisitorName(result) {
    //Report whether accepting the chat was succesful
    if (result.success == true) {
        console.log(result);
        visitorId = result.details.customDetails[0].value.toLowerCase();
    } else {
        console.log('Getting the details was not Succesful');
    }
};

function toogleImage(){
    $("#labelToCall").html('Video chat invite sent');
 $("#imgToChange").removeClass().addClass('small')
setTimeout(function(){$("#imgToChange").removeClass().addClass('big');},3500);
 setTimeout(function(){$("#imgToChange").removeClass().addClass('small');},7000);
  setTimeout(function(){$("#imgToChange").removeClass().addClass('big');},10500);

  setTimeout(function(){$("#labelToCall").html('');},14000);

}

sforce.console.onFocusedPrimaryTab(eventHandler);
</script>

</apex:page>
